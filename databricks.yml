# Databricks Asset Bundle Configuration for AI Signal Newsletter
# For details, see https://docs.databricks.com/dev-tools/bundles/index.html

bundle:
  name: ai_newsletter

targets:
  default:
    mode: development
    workspace:
      host: https://dbc-2647a0d2-b28d.cloud.databricks.com

  prod:
    mode: production

resources:
  jobs:
    create_volume_job:
      name: ai_newsletter_create_volume
      tasks:
        - task_key: run_create_volume_script
          notebook_task:
            notebook_path: ./src/create_uc_volume.py
            source: WORKSPACE
      max_concurrent_runs: 1

    twitter_ingestion_job:
      name: ai_newsletter_twitter_ingestion
      tasks:
        - task_key: run_ingestion_script
          notebook_task:
            notebook_path: ./src/twitter_ingestion_script.py
            source: WORKSPACE
      schedule:
        quartz_cron_expression: "0 */15 * * * ?" # Every 15 minutes
        timezone_id: UTC
      max_concurrent_runs: 1

    ai_newsletter_bronze_job:
      name: ai_newsletter_bronze_processing
      tasks:
        - task_key: run_bronze_processing
          notebook_task:
            notebook_path: ./src/ingestion_job.py
            source: WORKSPACE
      schedule:
        quartz_cron_expression: "0 0 * * * ?" # Hourly, or as needed after ingestion
        timezone_id: UTC
      max_concurrent_runs: 1

    ai_newsletter_silver_job:
      name: ai_newsletter_silver_processing
      tasks:
        - task_key: run_silver_processing
          notebook_task:
            notebook_path: ./src/silver_processing.py
            source: WORKSPACE
      schedule:
        quartz_cron_expression: "0 30 * * * ?" # Every hour at :30, after bronze processing
        timezone_id: UTC
      max_concurrent_runs: 1
