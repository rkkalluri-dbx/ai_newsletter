# Databricks Asset Bundle Configuration for AI Signal Newsletter
# For details, see https://docs.databricks.com/dev-tools/bundles/index.html

bundle:
  name: ai_newsletter

targets:
  default:
    mode: development
    workspace:
      host: https://dbc-2647a0d2-b28d.cloud.databricks.com

  prod:
    mode: production

resources:
  jobs:
    create_volume_job:
      name: ai_newsletter_create_volume
      tasks:
        - task_key: run_create_volume_script
          notebook_task:
            notebook_path: ./src/create_uc_volume.py
            source: WORKSPACE
      max_concurrent_runs: 1

    twitter_ingestion_job:
      name: ai_newsletter_twitter_ingestion
      tasks:
        - task_key: run_ingestion_script
          notebook_task:
            notebook_path: ./src/twitter_ingestion_script.py
            source: WORKSPACE
      schedule:
        quartz_cron_expression: "0 0 */4 * * ?" # Every 4 hours to avoid rate limits
        timezone_id: UTC
      max_concurrent_runs: 1

    ai_newsletter_bronze_silver_job:
      name: ai_newsletter_bronze_silver_processing
      tasks:
        - task_key: run_bronze_processing
          notebook_task:
            notebook_path: ./src/ingestion_job.py
            source: WORKSPACE
        - task_key: run_silver_processing
          notebook_task:
            notebook_path: ./src/silver_processing.py
            source: WORKSPACE
          depends_on:
            - task_key: run_bronze_processing
      schedule:
        quartz_cron_expression: "0 30 */4 * * ?" # Every 4 hours at :30 (after Twitter ingestion)
        timezone_id: UTC
      max_concurrent_runs: 1

    ai_newsletter_gold_daily_job:
      name: ai_newsletter_gold_daily_view
      tasks:
        - task_key: run_gold_daily_view
          notebook_task:
            notebook_path: ./src/gold_daily_view.py
            source: WORKSPACE
      schedule:
        quartz_cron_expression: "0 0 6 * * ?" # Daily at 06:00 UTC
        timezone_id: UTC
      max_concurrent_runs: 1

    ai_newsletter_gold_weekly_job:
      name: ai_newsletter_gold_weekly_rollup
      tasks:
        - task_key: run_gold_weekly_rollup
          notebook_task:
            notebook_path: ./src/gold_weekly_rollup.py
            source: WORKSPACE
      schedule:
        quartz_cron_expression: "0 0 7 * * ?" # Daily at 07:00 UTC (after daily view)
        timezone_id: UTC
      max_concurrent_runs: 1
